webpackJsonp([13],{"./app/containers/StudyPage/CrowdSection/index.js":function(t,e,n){"use strict";function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E;switch(arguments[1].type){case I:default:return t}}function i(){var t,e,n;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,Object(L.f)(N,a);case 2:return t=o.sent,o.next=5,Object(L.f)(T,r);case 5:return e=o.sent,o.next=8,Object(L.f)(U,a);case 8:return n=o.sent,o.next=11,Object(L.e)(B.LOCATION_CHANGE);case 11:return o.next=13,Object(L.b)(t);case 13:return o.next=15,Object(L.b)(e);case 15:return o.next=17,Object(L.b)(n);case 17:case"end":return o.stop()}},F,this)}function a(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(L.a)(J.a.post,Object($.b)(t),{add_meta:t});case 2:return e.next=4,Object(L.c)({type:G.h,nctId:t.nctId});case 4:case"end":return e.stop()}},K,this)}function r(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(L.a)(J.a.post,Object($.b)(t),{delete_meta:{key:t.key}});case 2:return e.next=4,Object(L.c)({type:G.h,nctId:t.nctId});case 4:case"end":return e.stop()}},M,this)}function s(){return{type:I}}function d(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function p(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function l(t){return{actions:Object(A.bindActionCreators)(h,t),wikiActions:Object(A.bindActionCreators)(z,t)}}Object.defineProperty(e,"__esModule",{value:!0});var h={};n.d(h,"defaultAction",function(){return s}),n.d(h,"createAnnotation",function(){return V}),n.d(h,"updateAnnotation",function(){return W}),n.d(h,"deleteAnnotation",function(){return q});var f=n("./node_modules/lodash/lodash.js"),b=n.n(f),y=n("./node_modules/react/index.js"),v=n.n(y),g=(n("./node_modules/prop-types/index.js"),n("./node_modules/react-redux/es/index.js")),w=n("./node_modules/react-helmet/lib/Helmet.js"),m=n("./node_modules/reselect/es/index.js"),A=n("./node_modules/redux/es/index.js"),j=n("./node_modules/react-bootstrap/es/index.js"),S=n("./app/utils/injectSaga.js"),O=n("./app/utils/injectReducer.js"),k=n("./app/containers/AuthHeader/selectors.js"),x=n("./app/components/LoadingPane/index.js"),C=n("./app/containers/StudyPage/selectors.js"),R=function(t){return t.get("crowdSection")},_=function(){return Object(m.createSelector)(R,function(t){return t.toJS()})},D=_,P=n("./node_modules/immutable/dist/immutable.js"),I="app/CrowdSection/DEFAULT_ACTION",N="app/CrowdSection/ANNOTATION_CREATE",T="app/CrowdSection/ANNOTATION_DELETE",U="app/CrowdSection/ANNOTATION_UPDATE",E=Object(P.fromJS)({}),H=o,L=n("./node_modules/redux-saga/es/effects.js"),B=n("./node_modules/react-router-redux/index.js"),J=n("./app/utils/client.js"),G=n("./app/containers/StudyPage/constants.js"),$=n("./app/containers/StudyPage/saga.js"),F=regeneratorRuntime.mark(i),K=regeneratorRuntime.mark(a),M=regeneratorRuntime.mark(r),V=function(t,e,n){return{type:N,nctId:t,key:e,value:n}},W=function(t,e,n){return{type:U,nctId:t,key:e,value:n}},q=function(t,e){return{type:T,nctId:t,key:e}},z=n("./app/containers/StudyPage/WikiSection/actions.js");n.d(e,"CrowdSection",function(){return nt});var Q=function(){var t="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;return function(e,n,o,i){var a=e&&e.defaultProps,r=arguments.length-3;if(n||0===r||(n={}),n&&a)for(var s in a)void 0===n[s]&&(n[s]=a[s]);else n||(n=a||{});if(1===r)n.children=i;else if(r>1){for(var d=Array(r),c=0;c<r;c++)d[c]=arguments[c+3];n.children=d}return{$$typeof:t,type:e,key:void 0===o?null:""+o,ref:null,props:n,_owner:null}}}(),X=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},Y=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),Z=Q(x.a,{}),tt=Q(w.Helmet,{},void 0,Q("title",{},void 0,"Crowd Annotations")),et=Q("thead",{},void 0,Q("tr",{},void 0,Q("th",{width:"20%"},void 0,"Label"),Q("th",{width:"60%"},void 0,"Description"),Q("th",{width:"10%"}),Q("th",{width:"10%"}))),nt=function(t){function e(t){c(this,e);var n=u(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.rowIsUpdating=n.rowIsUpdating.bind(n),n.rowIsRemoved=n.rowIsRemoved.bind(n),n.onAnnotationUpdateSubmit=n.onAnnotationUpdateSubmit.bind(n),n.onAnnotationDelete=n.onAnnotationDelete.bind(n),n.addAnnotation=n.addAnnotation.bind(n),n.onDescriptionChange=n.onDescriptionChange.bind(n),n.createAnnotation=n.createAnnotation.bind(n),n.appendAnnotation=n.appendAnnotation.bind(n),n.appendAnnotationSubmit=n.appendAnnotationSubmit.bind(n),n.annotationRefs={},n.state={updateableRows:{},appendingRows:{},appendingDescriptions:{}},n.updateRowData={},n.removedRows={},n}return p(e,t),Y(e,[{key:"onAnnotationUpdateSubmit",value:function(t,e){if(this.props.AuthHeader.user.loggedIn){var n=t+"-"+e;if(this.rowIsUpdating(n)){var o=this.updateRowData[n].description;if(b.a.includes(this.props.StudyPage.wiki.meta[t],"|")){var i=b.a.map(this.props.StudyPage.wiki.meta[t].split("|"),function(t){return t===e?o:t});o=i.join("|")}this.props.actions.updateAnnotation(this.props.StudyPage.study.nct_id,t,o)}this.state.updateableRows[n]=!this.state.updateableRows[n],this.forceUpdate()}else this.props.onAnonymousClick()}},{key:"onAnnotationDelete",value:function(t,e){if(this.props.AuthHeader.user.loggedIn)if(this.removedRows[t+"-"+e]=!0,e===this.props.StudyPage.wiki.meta[t])this.props.actions.deleteAnnotation(this.props.StudyPage.study.nct_id,t);else{var n=b.a.filter(this.props.StudyPage.wiki.meta[t].split("|"),function(t){return t!==e});this.props.actions.updateAnnotation(this.props.StudyPage.study.nct_id,t,n.join("|"))}else this.props.onAnonymousClick()}},{key:"onDescriptionChange",value:function(t,e){this.updateRowData[e]=this.updateRowData[e]||{},this.updateRowData[e].description=t.target.value}},{key:"addAnnotation",value:function(){this.props.AuthHeader.user.loggedIn?(this.isAddingAnnotation=!0,this.forceUpdate()):this.props.onAnonymousClick()}},{key:"createAnnotation",value:function(){this.props.actions.createAnnotation(this.props.StudyPage.study.nct_id,this.newLabel,this.newDescription),this.newLabel="",this.newDescription="",this.isAddingAnnotation=!1}},{key:"appendAnnotation",value:function(t){this.props.AuthHeader.user.loggedIn?this.setState(X({},this.state,{appendingRows:X({},this.state.appendingRows,d({},t,!0))})):this.props.onAnonymousClick()}},{key:"appendAnnotationSubmit",value:function(t){var e=this.props.StudyPage.wiki.meta[t]+"|"+this.state.appendingDescriptions[t];this.props.actions.updateAnnotation(this.props.StudyPage.study.nct_id,t,e),this.setState(X({},this.state,{appendingRows:b.a.omit(this.state.appendingRows,t),appendingDescriptions:b.a.omit(this.state.appendingDescriptions,t)}))}},{key:"rowIsUpdating",value:function(t){return this.state.updateableRows[t]}},{key:"rowIsRemoved",value:function(t,e){return this.removedRows&&this.removedRows[t+"-"+e]}},{key:"render",value:function(){var t=this;if(!b.a.get(this.props,"StudyPage.wiki.meta"))return Z;var e=[];return b.a.forOwn(this.props.StudyPage.wiki.meta,function(n,o){var i=Q("td",{},void 0,o);b.a.forEach(n.split("|"),function(n){return e.push(Q("tr",{},o+"-"+n,i,Q("td",{},void 0,t.rowIsUpdating(o+"-"+n)?Q("textarea",{style:{width:"100%",border:"1px solid #ccc"},type:"text",defaultValue:n,onChange:function(e){return t.onDescriptionChange(e,o+"-"+n)},onKeyDown:function(e){27===e.keyCode&&(t.state.updateableRows[o+"-"+n]=!1,t.forceUpdate())}}):n),Q("td",{},void 0,Q(j.Button,{onClick:function(){return t.appendAnnotation(o)}},void 0,"Add")),Q("td",{},void 0,Q(j.Button,{onClick:function(){return t.onAnnotationUpdateSubmit(o,n)}},void 0,t.state.updateableRows[o+"-"+n]?"Submit":"Update")),Q("td",{},void 0,Q(j.Button,{onClick:function(){return t.onAnnotationDelete(o,n)}},void 0,"Delete"))))}),t.state.appendingRows[o]&&e.push(Q("tr",{},o+"-appending",Q("td",{},void 0,o),Q("td",{},void 0,Q("textarea",{style:{width:"100%",border:"1px solid #ccc"},placeholder:"Add a description...",onChange:function(e){return t.setState(X({},t.state,{appendingDescriptions:X({},t.state.appendingDescriptions,d({},o,e.target.value))}))}})),Q("td",{colSpan:3,className:"text-right"},void 0,Q(j.Button,{onClick:function(){return t.appendAnnotationSubmit(o)}},void 0,"Submit"))))}),Q(j.Grid,{},void 0,tt,Q(j.Table,{striped:!0},void 0,et,Q("tbody",{},void 0,e,this.isAddingAnnotation?Q("tr",{},void 0,Q("td",{},void 0,Q("input",{style:{width:"100%",border:"1px solid #ccc"},placeholder:"Add a label...",onChange:function(e){t.newLabel=e.target.value}})),Q("td",{},void 0,Q("textarea",{style:{width:"100%",border:"1px solid #ccc"},placeholder:"Add a description...",onChange:function(e){t.newDescription=e.target.value}})),Q("td",{colSpan:3,className:"text-right"},void 0,Q(j.Button,{onClick:this.createAnnotation},void 0,"Submit"))):Q("tr",{},void 0,Q("td",{colSpan:5,className:"text-right"},void 0,Q(j.Button,{onClick:this.addAnnotation},void 0,"Add"))))))}}]),e}(v.a.Component),ot=Object(m.createStructuredSelector)({CrowdSection:D(),StudyPage:Object(C.a)(),AuthHeader:Object(k.default)()}),it=Object(g.connect)(ot,l),at=Object(O.a)({key:"crowdSection",reducer:H}),rt=Object(S.a)({key:"crowdSection",saga:i});e.default=Object(A.compose)(at,rt,it)(nt)}});